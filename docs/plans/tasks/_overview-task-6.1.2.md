# 全体設計書: Task 6.1.2 ブックマーク機能

生成日時: 2025-08-02
対象計画書: Task 6.1.2 ブックマーク機能
分解元資料: .tmp/task-6.1.2-decomposition.md

## プロジェクトの全体像

### 目的とゴール
ワンタップでブックマーク追加/削除、メモ機能付きブックマーク、カテゴリ別フィルタ・検索機能を備えた重要問題マーク機能を実装し、学習効率を向上させる。

### 背景とコンテキスト
受験準備システムにおいて、学習者が重要な問題や再学習が必要な問題を効率的に管理できる仕組みが求められている。特にモバイル学習では直感的な操作が重要である。

## タスク分割の設計

### 分割方針
並行開発を可能にするため、依存関係を最小化し、3つのフェーズに分割：
1. **Phase 1（並行実行）**: 基盤実装（データベース、UI、状態管理）
2. **Phase 2（並行実行）**: 機能実装（API、管理ページ）  
3. **Phase 3（統合）**: API連携・品質保証

### タスク間の関連マップ
```
Phase 1 (並行実行 - 0-30分):
A: データベース設計    B: ブックマークボタン    C: 状態管理拡張
   (Backend専門)        (Frontend専門)          (State専門)
        ↓                     ↓                    ↓
Phase 2 (並行実行 - 30-50分):  
D: バックエンドAPI     E: ブックマーク管理ページ
   (Backend専門)        (Frontend専門)
        ↓                     ↓
Phase 3 (統合 - 50-70分):
F: API連携・統合テスト
   (Quality専門)
```

### 共通化ポイント
- **TypeScript型定義**: `frontend/src/types/bookmark.ts`で統一定義
- **エラーハンドリング**: 一貫したパターンでAPI通信エラーを処理
- **デザインパターン**: BookmarkButtonのスタイルを管理ページでも統一使用
- **テストパターン**: 各コンポーネントで共通のテスト構造を採用

## 実装時の注意事項

### 全体を通じて守るべき原則
1. **並行開発対応**: 各タスクは独立して実行可能な設計を維持
2. **TypeScript型安全性**: 全ての型定義を厳密に行い、`any`型の使用を避ける
3. **モバイルファースト**: レスポンシブデザインでモバイル体験を最優先
4. **テスト駆動開発**: Red-Green-Refactorサイクルを各タスクで実践
5. **ユーザビリティ**: 直感的な操作を実現し、フィードバックを適切に提供

### リスクと対策
- **リスク1**: 型定義の競合
  - **対策**: Phase1で型定義を最初に確定し、共有ファイルで管理
- **リスク2**: API仕様の相違
  - **対策**: スキーマ設計完了後、APIインターフェースを明文化
- **リスク3**: 状態管理の複雑化
  - **対策**: 単一ストアファイルで一元管理、明確なアクション定義
- **リスク4**: モバイル表示の崩れ
  - **対策**: 既存QuestionCardとの統合時に表示確認を徹底

### 影響範囲の管理
- **変更が許可される範囲**: 
  - 新規ファイル作成（コンポーネント、ストア、API）
  - QuestionCard.tsxへのBookmarkButton統合
  - PrismaスキーマへのBookmarkモデル追加
- **変更禁止エリア**: 
  - 既存の認証システム
  - 他機能の状態管理ストア
  - 基本的なレイアウト構造

## 品質保証の指針

### 各タスクでの品質基準
- **コードカバレッジ**: 新規追加部分で80%以上
- **TypeScriptエラー**: 0件
- **ESLint警告**: 0件
- **テスト成功率**: 100%（追加されたテスト）

### 統合時の品質基準
- **エンドツーエンドテスト**: 全ブックマーク操作が正常動作
- **レスポンス時間**: API応答200ms以内
- **モバイル対応**: 主要ブラウザでタッチ操作が快適
- **アクセシビリティ**: WCAG 2.1 AA準拠

## 実行スケジュールと担当割り当て

### Phase 1 (0-30分) - 3タスク並行実行
- **6.1.2-A**: データベーススキーマ設計・実装
  - 担当: backend-executor
  - 成果物: Bookmarkモデル、マイグレーション、シードデータ
- **6.1.2-B**: ブックマークボタンコンポーネント  
  - 担当: frontend-executor
  - 成果物: BookmarkButtonコンポーネント、QuestionCard統合
- **6.1.2-C**: Zustand状態管理拡張
  - 担当: task-executor
  - 成果物: useBookmarkStoreストア、型定義

### Phase 2 (30-50分) - 2タスク並行実行
- **6.1.2-D**: バックエンドAPI実装
  - 担当: backend-executor
  - 依存: 6.1.2-A完了
  - 成果物: CRUD APIエンドポイント
- **6.1.2-E**: ブックマーク管理ページ
  - 担当: frontend-executor  
  - 依存: 6.1.2-B, 6.1.2-C完了推奨
  - 成果物: BookmarksPage、関連コンポーネント

### Phase 3 (50-70分) - 統合フェーズ
- **6.1.2-F**: API連携・統合テスト
  - 担当: quality-fixer
  - 依存: 全タスク完了
  - 成果物: 完全に動作するブックマーク機能

## 成功条件

### 機能的成功条件
- [ ] QuestionCardでワンタップブックマーク操作
- [ ] ブックマーク管理ページでの一覧・フィルタ・検索
- [ ] メモ機能での個人ノート管理
- [ ] モバイル・デスクトップ両対応の快適な操作

### 技術的成功条件  
- [ ] TypeScript型安全性の完全確保
- [ ] 全CRUD操作の正常動作
- [ ] エラーハンドリングの適切な実装
- [ ] レスポンシブUIとアクセシビリティ対応

### 品質的成功条件
- [ ] 全テストケースのパス（100%成功率）
- [ ] コード品質チェックのクリア
- [ ] パフォーマンス基準の達成
- [ ] ユーザビリティテストでの良好な評価